# Kaido Tech Blog

åŸºæ–¼ Hugo + Nginx + Certbot çš„æŠ€è¡“éƒ¨è½æ ¼å°ˆæ¡ˆï¼Œä½¿ç”¨ Docker Compose éƒ¨ç½²ã€‚

## å°ˆæ¡ˆç‰¹è‰²

- ğŸš€ ä½¿ç”¨ Hugo éœæ…‹ç¶²ç«™ç”Ÿæˆå™¨ï¼Œå¿«é€Ÿä¸”SEOå‹å–„
- âš¡ å³æ™‚æ›´æ–°åŠŸèƒ½ï¼Œæ–°å¢æ–‡ç« è‡ªå‹•ç™¼å¸ƒï¼Œç„¡éœ€é‡å»ºæ˜ åƒæª”
- ğŸ”’ è‡ªå‹• SSL æ†‘è­‰ç”³è«‹èˆ‡çºŒæœŸ (Let's Encrypt)
- ğŸ³ å®Œå…¨ Docker åŒ–éƒ¨ç½²
- ğŸ“¦ ç‰ˆæœ¬åŒ–ç®¡ç†ï¼Œå¯åŒ¯å‡ºéƒ¨ç½²åˆ°å…¶ä»–ä¼ºæœå™¨
- ğŸ”§ æä¾› Makefile å’Œè…³æœ¬å…©ç¨®æ“ä½œæ–¹å¼

## æŠ€è¡“æ£§

- **Hugo**: klakegg/hugo:ext-alpine
- **Nginx**: nginx:alpine
- **Certbot**: certbot/certbot
- **è¨­è¨ˆ**: è‡ªè¨‚éŸ¿æ‡‰å¼ä½ˆå±€

## å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒè¨­å®š

è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬ä¸¦ä¿®æ”¹è¨­å®šï¼š

```bash
cp .env.example .env
```

ç·¨è¼¯ `.env` æª”æ¡ˆï¼Œè¨­å®šæ‚¨çš„ç¶²åŸŸå’Œ Emailï¼š

```env
DOMAIN_NAME=your-domain.com
EMAIL=your-email@example.com
VERSION=1.0.0
```

### 2. æª¢æŸ¥ç³»çµ±éœ€æ±‚

ç¢ºèªç³»çµ±æ˜¯å¦å®‰è£å¿…è¦å·¥å…·ï¼š

```bash
# æª¢æŸ¥ Docker å’Œ Docker Compose
docker --version
docker compose version

# æª¢æŸ¥æ˜¯å¦æœ‰ makeï¼ˆå¯é¸ï¼‰
which make
```

### 3. éƒ¨ç½²æ–¹å¼

æœ¬å°ˆæ¡ˆæä¾›å…©ç¨®æ“ä½œæ–¹å¼ï¼Œé¸æ“‡å…¶ä¸€å³å¯ï¼š

#### æ–¹å¼ A: ä½¿ç”¨ Make æŒ‡ä»¤ï¼ˆæ¨è–¦ï¼Œéœ€å®‰è£ makeï¼‰

å¦‚æœç³»çµ±æ²’æœ‰ makeï¼Œå¯å®‰è£ï¼š
```bash
sudo apt update && sudo apt install make
```

åˆæ¬¡éƒ¨ç½²ï¼š
```bash
# å»ºç½®æ˜ åƒæª”
make build

# éƒ¨ç½²æœå‹™ï¼ˆåŒ…å« SSL æ†‘è­‰ç”³è«‹ï¼‰
make deploy
```

æ—¥å¸¸æ“ä½œï¼š
```bash
# æª¢è¦–å¯ç”¨æŒ‡ä»¤
make help

# æª¢æŸ¥æœå‹™ç‹€æ…‹
make status

# æª¢è¦–æœå‹™æ—¥èªŒ
make logs

# åœæ­¢/å•Ÿå‹•æœå‹™
make down
make up
```

#### æ–¹å¼ B: ç›´æ¥ä½¿ç”¨è…³æœ¬ï¼ˆä¸éœ€å®‰è£ makeï¼‰

åˆæ¬¡éƒ¨ç½²ï¼š
```bash
# å»ºç½®æ˜ åƒæª”
./scripts/build.sh

# éƒ¨ç½²æœå‹™ï¼ˆåŒ…å« SSL æ†‘è­‰ç”³è«‹ï¼‰
./scripts/deploy.sh
```

æ—¥å¸¸æ“ä½œï¼š
```bash
# æª¢æŸ¥æœå‹™ç‹€æ…‹
docker compose ps

# æª¢è¦–æœå‹™æ—¥èªŒ
docker compose logs -f

# åœæ­¢/å•Ÿå‹•æœå‹™
docker compose down
docker compose up -d

# åŒ¯å‡ºéƒ¨ç½²å¥—ä»¶
./scripts/export.sh
```

## ç›®éŒ„çµæ§‹

```
kaido-whom/
â”œâ”€â”€ hugo/                 # Hugo ç¶²ç«™å…§å®¹
â”‚   â”œâ”€â”€ config.yaml      # Hugo é…ç½®
â”‚   â”œâ”€â”€ content/         # ç¶²ç«™å…§å®¹
â”‚   â”‚   â”œâ”€â”€ posts/       # æ–‡ç« ç›®éŒ„
â”‚   â”‚   â”œâ”€â”€ _index.md    # é¦–é å…§å®¹
â”‚   â”‚   â””â”€â”€ search.md    # æœå°‹é é¢
â”‚   â”œâ”€â”€ layouts/         # è‡ªè¨‚ä½ˆå±€æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ _default/    # é è¨­æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ baseof.html   # åŸºç¤æ¨¡æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ list.html     # åˆ—è¡¨é æ¨¡æ¿
â”‚   â”‚   â”‚   â””â”€â”€ single.html   # å–®é æ¨¡æ¿
â”‚   â”‚   â””â”€â”€ index.html   # é¦–é æ¨¡æ¿
â”‚   â””â”€â”€ static/          # éœæ…‹æª”æ¡ˆ
â”œâ”€â”€ nginx/               # Nginx é…ç½®
â”‚   â”œâ”€â”€ nginx.conf       # ä¸»é…ç½®æª”
â”‚   â””â”€â”€ conf.d/          # ç¶²ç«™é…ç½®
â”œâ”€â”€ certbot/             # SSL æ†‘è­‰ç®¡ç†
â”‚   â”œâ”€â”€ init-letsencrypt.sh
â”‚   â””â”€â”€ renew-certs.sh
â”œâ”€â”€ scripts/             # ç®¡ç†è…³æœ¬
â”‚   â”œâ”€â”€ build.sh         # å»ºç½®è…³æœ¬
â”‚   â”œâ”€â”€ deploy.sh        # éƒ¨ç½²è…³æœ¬
â”‚   â”œâ”€â”€ export.sh        # åŒ¯å‡ºè…³æœ¬
â”‚   â”œâ”€â”€ hugo-watch.sh    # Hugo ç›£æ§è…³æœ¬
â”‚   â””â”€â”€ update-version.sh # ç‰ˆæœ¬æ›´æ–°è…³æœ¬
â”œâ”€â”€ docker-compose.yml   # Docker Compose é…ç½®
â”œâ”€â”€ Dockerfile.hugo      # è‡ªè¨‚ Dockerfile
â”œâ”€â”€ .env                 # ç’°å¢ƒè®Šæ•¸
â””â”€â”€ Makefile            # Make æŒ‡ä»¤
```

## æ–°å¢æ–‡ç« 

åœ¨ `hugo/content/posts/` ç›®éŒ„ä¸‹å»ºç«‹æ–°çš„ Markdown æª”æ¡ˆï¼š

```markdown
---
title: "æ–‡ç« æ¨™é¡Œ"
date: 2024-01-01T00:00:00+08:00
draft: false
tags: ["æ¨™ç±¤1", "æ¨™ç±¤2"]
categories: ["åˆ†é¡"]
---

æ–‡ç« å…§å®¹...
```

å»ºç«‹æ–‡ç« å¾Œï¼Œ**ä¸éœ€è¦é‡å»ºæ˜ åƒæª”**ï¼Hugo æœƒè‡ªå‹•ç›£æ§è®Šæ›´ä¸¦å³æ™‚æ›´æ–°ç¶²ç«™ã€‚

## æ˜ åƒæª”é‡å»ºæ™‚æ©Ÿ

### âŒ ä¸éœ€è¦é‡å»ºæ˜ åƒæª”çš„æƒ…æ³

ä»¥ä¸‹æ“ä½œæœƒ**è‡ªå‹•æ›´æ–°**ï¼Œç„¡éœ€é‡å»ºæ˜ åƒæª”ï¼š

- âœ… **æ–°å¢æ–‡ç« ** - åœ¨ `hugo/content/posts/` æ–°å¢ `.md` æª”æ¡ˆ
- âœ… **ä¿®æ”¹æ–‡ç« ** - ç·¨è¼¯ç¾æœ‰çš„ `.md` æª”æ¡ˆå…§å®¹
- âœ… **åˆªé™¤æ–‡ç« ** - ç§»é™¤ `.md` æª”æ¡ˆ
- âœ… **ä¿®æ”¹æ–‡ç« å…ƒè³‡æ–™** - æ›´æ”¹ front matterï¼ˆæ¨™é¡Œã€æ—¥æœŸã€æ¨™ç±¤ç­‰ï¼‰
- âœ… **æ–°å¢éœæ…‹æª”æ¡ˆ** - åœ¨ `hugo/static/` æ–°å¢åœ–ç‰‡ç­‰æª”æ¡ˆ

### âš ï¸ éœ€è¦é‡å»ºæ˜ åƒæª”çš„æƒ…æ³

ä»¥ä¸‹è®Šæ›´éœ€è¦é‡å»ºæ˜ åƒæª”ï¼š

#### ğŸ”§ Hugo é…ç½®è®Šæ›´
```bash
# ç•¶ä¿®æ”¹é€™äº›æª”æ¡ˆæ™‚éœ€è¦é‡å»º
hugo/config.yaml          # Hugo åŸºç¤é…ç½®
hugo/layouts/**/*.html     # ä½ˆå±€æ¨¡æ¿æª”æ¡ˆ
```

#### ğŸ³ å®¹å™¨é…ç½®è®Šæ›´  
```bash
# ç•¶ä¿®æ”¹é€™äº›æª”æ¡ˆæ™‚éœ€è¦é‡å»º
docker-compose.yml         # æœå‹™é…ç½®
Dockerfile.hugo            # Hugo å»ºç½®é…ç½®
nginx/nginx.conf           # Nginx ä¸»é…ç½®
nginx/conf.d/*.conf        # Nginx è™›æ“¬ä¸»æ©Ÿé…ç½®
```

#### ğŸ“¦ ç‰ˆæœ¬å‡ç´š
```bash
# ç•¶é€²è¡Œç‰ˆæœ¬å‡ç´šæ™‚éœ€è¦é‡å»º
VERSION                    # ç‰ˆæœ¬è™Ÿæª”æ¡ˆ
.env                      # ç’°å¢ƒè®Šæ•¸ä¸­çš„ VERSION
```

### ğŸ› ï¸ å¦‚ä½•é‡å»ºæ˜ åƒæª”

ç•¶éœ€è¦é‡å»ºæ™‚ï¼ŒåŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

**ä½¿ç”¨ Make æŒ‡ä»¤:**
```bash
make build    # é‡å»ºæ˜ åƒæª”
make up       # é‡æ–°å•Ÿå‹•æœå‹™
```

**ä½¿ç”¨è…³æœ¬:**
```bash
./scripts/build.sh        # é‡å»ºæ˜ åƒæª”
docker compose up -d      # é‡æ–°å•Ÿå‹•æœå‹™
```

### ğŸ“ å¿«é€Ÿåˆ¤æ–·åŸå‰‡

- **å…§å®¹è®Šæ›´**ï¼ˆæ–‡ç« ã€åœ–ç‰‡ï¼‰â†’ âŒ ä¸éœ€é‡å»º
- **é…ç½®è®Šæ›´**ï¼ˆæ¨¡æ¿ã€è¨­å®šï¼‰â†’ âš ï¸ éœ€è¦é‡å»º
- **ç‰ˆæœ¬å‡ç´š** â†’ âš ï¸ éœ€è¦é‡å»º

## ç‰ˆæœ¬ç®¡ç†

### æ›´æ–°ç‰ˆæœ¬è™Ÿ

**ä½¿ç”¨ Make æŒ‡ä»¤:**
```bash
make update-version VERSION=1.0.1
```

**ä½¿ç”¨è…³æœ¬:**
```bash
./scripts/update-version.sh 1.0.1
```

### åŒ¯å‡ºéƒ¨ç½²å¥—ä»¶

**ä½¿ç”¨ Make æŒ‡ä»¤:**
```bash
make export
```

**ä½¿ç”¨è…³æœ¬:**
```bash
./scripts/export.sh
```

é€™æœƒåœ¨ `exports/` ç›®éŒ„ç”¢ç”Ÿå¯ç§»æ¤åˆ°å…¶ä»–ä¼ºæœå™¨çš„éƒ¨ç½²å¥—ä»¶ã€‚

## SSL æ†‘è­‰ç®¡ç†

### åˆå§‹åŒ– SSL æ†‘è­‰ï¼ˆåƒ…é¦–æ¬¡éœ€è¦ï¼‰

**ä½¿ç”¨ Make æŒ‡ä»¤:**
```bash
make ssl-init
```

**ä½¿ç”¨è…³æœ¬:**
```bash
./certbot/init-letsencrypt.sh
```

### æ‰‹å‹•çºŒæœŸæ†‘è­‰

**ä½¿ç”¨ Make æŒ‡ä»¤:**
```bash
make ssl-renew
```

**ä½¿ç”¨è…³æœ¬:**
```bash
./certbot/renew-certs.sh
```

### è¨­å®šè‡ªå‹•çºŒæœŸ

å»ºè­°åœ¨ä¼ºæœå™¨ä¸Šè¨­å®š crontabï¼š

```bash
# ç·¨è¼¯ crontab
crontab -e

# æ–°å¢ä»¥ä¸‹è¡Œï¼šæ¯é€±æ—¥å‡Œæ™¨ 3 é»æª¢æŸ¥æ†‘è­‰çºŒæœŸ
0 3 * * 0 /path/to/project/certbot/renew-certs.sh
```

## ç§»æ¤åˆ°å…¶ä»–ä¼ºæœå™¨

1. **åŒ¯å‡ºéƒ¨ç½²å¥—ä»¶:**
   - ä½¿ç”¨ Make: `make export`
   - ä½¿ç”¨è…³æœ¬: `./scripts/export.sh`

2. å°‡ `exports/` ç›®éŒ„å…§å®¹è¤‡è£½åˆ°ç›®æ¨™ä¼ºæœå™¨

3. ä¾ç…§ `exports/README-DEPLOYMENT.md` æŒ‡ç¤ºéƒ¨ç½²

## ç–‘é›£æ’è§£

### æŸ¥çœ‹æœå‹™ç‹€æ…‹

**ä½¿ç”¨ Make æŒ‡ä»¤:**
```bash
make status
```

**ä½¿ç”¨ Docker Compose:**
```bash
docker compose ps
```

### æŸ¥çœ‹æ—¥èªŒ

**ä½¿ç”¨ Make æŒ‡ä»¤:**
```bash
make logs
```

**ä½¿ç”¨ Docker Compose:**
```bash
docker compose logs -f
```

### é‡æ–°ç”³è«‹ SSL æ†‘è­‰

**ä½¿ç”¨ Make æŒ‡ä»¤:**
```bash
make down
rm -rf certbot/conf
make ssl-init
```

**ä½¿ç”¨è…³æœ¬:**
```bash
docker compose down
rm -rf certbot/conf
./certbot/init-letsencrypt.sh
```

### å¸¸è¦‹å•é¡Œ

1. **æ†‘è­‰ç”³è«‹å¤±æ•—**: ç¢ºèªç¶²åŸŸ DNS è¨­å®šæ­£ç¢ºï¼Œä¸”æŒ‡å‘ä¼ºæœå™¨ IP
2. **æœå‹™ç„¡æ³•å•Ÿå‹•**: æª¢æŸ¥ `.env` æª”æ¡ˆè¨­å®šæ˜¯å¦æ­£ç¢º
3. **Hugo å»ºç½®å¤±æ•—**: ç¢ºèª `hugo/` ç›®éŒ„ä¸‹çš„å…§å®¹å®Œæ•´

## ç‰ˆæœ¬æ­·ç¨‹

### v1.0.0 (2025-09-04)
**å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬**

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âœ… Hugo + Nginx + Certbot å®Œæ•´æ¶æ§‹
- âœ… è‡ªå‹• SSL æ†‘è­‰ç”³è«‹èˆ‡çºŒæœŸ
- âœ… å³æ™‚æ–‡ç« æ›´æ–°åŠŸèƒ½ï¼ˆç„¡éœ€é‡å»ºæ˜ åƒæª”ï¼‰
- âœ… è‡ªè¨‚éŸ¿æ‡‰å¼ä½ˆå±€è¨­è¨ˆ
- âœ… Docker Compose å¤šæœå‹™éƒ¨ç½²

**æŠ€è¡“ç‰¹è‰²**ï¼š
- ğŸš€ Hugo ç›£æ§æ¨¡å¼ï¼Œæ–‡ç« å³æ™‚ç™¼å¸ƒ
- ğŸ”’ Let's Encrypt è‡ªå‹•æ†‘è­‰ç®¡ç†
- ğŸ¨ ç°¡æ½”ç™½è‰²å¡ç‰‡é¢¨æ ¼è¨­è¨ˆ
- ğŸ“± å®Œå…¨éŸ¿æ‡‰å¼ä½ˆå±€
- ğŸ”§ é›™é‡æ“ä½œæ–¹å¼ï¼ˆMake + è…³æœ¬ï¼‰

**å·²å¯¦ç¾åŠŸèƒ½**ï¼š
- é¦–é æ–‡ç« åˆ—è¡¨å±•ç¤º
- æ–‡ç« åˆ†é¡å’Œæ¨™ç±¤ç³»çµ±
- æœå°‹åŠŸèƒ½é é¢
- HTTPS å®‰å…¨é€£ç·š
- ç‰ˆæœ¬åŒ–æ˜ åƒæª”ç®¡ç†
- å¯ç§»æ¤éƒ¨ç½²å¥—ä»¶åŒ¯å‡º